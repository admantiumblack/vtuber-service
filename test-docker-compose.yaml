version: '3.7'
services:
    database:
        image: mysql:8.0.32
        environment:
            - MYSQL_ROOT_PASSWORD=not_admin
            - MYSQL_USER=masbro
            - MYSQL_PASSWORD=mantap
            - MYSQL_DATABASE=vtuber_db
        ports:
            - 3306:3306

    object_storage:
        image: bitnami/minio:latest
        ports:
            - '9000:9000'
            - '9001:9001'
        environment:
            - MINIO_ROOT_USER=minio-root-user
            - MINIO_ROOT_PASSWORD=minio-root-password

    frontend_server:
        build: ./vtuber-frontend-service
        ports:
            - 3000:3000
        env_file:
            - ./vtuber-etl-service/.env.example
        links:
            - database:mysql
    
    video_service:
        build: ./vtuber-video-services
        ports:
            - 8000:8000
        env_file:
            - ./vtuber-video-services/.env.example
        volumes:
            - ./vtuber-video-services:/project
        depends_on:
            - database
        links:
            - database:mysql
        
    discography_service:
        build: ./vtuber-discography-services
        ports:
            - 8001:8000
        env_file:
            - ./vtuber-discography-services/.env.example
        volumes:
            - ./vtuber-discography-services/app:/app/app
            - ./vtuber-discography-services/config:/app/config
            - ./vtuber-discography-services/database:/app/database
            - ./vtuber-discography-services/public:/app/public
            - ./vtuber-discography-services/resources:/app/resources
            - ./vtuber-discography-services/routes:/app/routes
            - ./vtuber-discography-services/tests:/app/tests
        depends_on:
            - database
        links:
            - database:mysql
        restart: on-failure
        
    art_service:
        build: ./vtuber-art-services
        ports:
            - 3001:3000
        # env_file:
        #     - ./vtuber-art-services/.env.example
        volumes:
            - ./vtuber-art-services:/usr/local/apps/app/dev
        depends_on:
            - database
        links:
            - database:mysql
volumes:
    ignore: